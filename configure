#!/bin/sh

do_help() {
	echo "Optional features:"
	echo "  --enable-termcap	enable termcap and disable ansi"
	echo "  --enable-dbg		debugging and runtime error checking"
	echo "  --enable-comment-bold	bold comments for C code"
	echo "  --enable-help		enable builtin help"
	echo "  --enable-shell	enable shell commands"
	echo "  --enable-spell	enable spell checking"
	echo "  --enable-tags		ctags/etags support"
	echo "  --enable-undo		EXPERIMNETAL undo"
	echo
	echo "Meta-features:"
	echo "  --enable-minconfig	disable everything"
	echo "  --enable-maxconfig	enable everything"
	echo
	echo "To disable a feature replace --enable with --disable."
	echo "Disabling a meta-feature is a NOP."

	exit 0
}

while [ -n "$1" ]; do
	case "$1" in
	--enable-*) enable=1;;
	--disable-*) enable=0;;
	--help) do_help;;
	*) echo "Unknown arg '$1' ignored"; shift; continue;;
	esac

	case "$1" in
	*-termcap) termcap=$enable;;
	*-dbg) dbg=$enable;;
	*-minconfig) minconfig=$enable;;
	*-maxconfig) maxconfig=$enable;;
	*-comment-bold) comment=$enable;;
	*-undo) undo=$enable;;
	*-help) help=$enable;;
	*-shell) shell=$enable;;
	*-spell) spell=$enable;;
	*-tags) tags=$enable;;
	*) echo "Unknown arg '$1' ignored";;
	esac

	shift
done

do_toggle() {
	if [ "$2" = 1 ]; then
		echo "#define $1" >> configure.h
	elif [ "$2" = 0 ]; then
		echo "#undef $1" >> configure.h
	fi
}

echo "/* Generated by configure `date` */" > configure.h
if [ -n "$termcap" ]; then
	if [ $termcap = 1 ]; then
		do_toggle ANSI 0
		do_toggle TERMCAP 1
	else
		do_toggle ANSI 1
		do_toggle TERMCAP 0
	fi
fi

[ -n "$dbg" ] && echo -e "#undef  DBG\n#define DBG $dbg" >> configure.h

if [ "$minconfig" = 1 ]; then
	# Sanity check
	if [ "$maxconfig" = 1 ]; then
		echo "--enable-minconfig and --enable-maxconfig are incompatible"
		exit 1
	fi

	comment=0; undo=0; help=0; shell=0; spell=0; tags=0
elif [ "$maxconfig" = 1 ]; then
	comment=1; undo=1; help=1; shell=1; spell=1; tags=1
fi

[ -n "$comment" ] && echo -e "#undef  COMMENTBOLD\n#define COMMENTBOLD $comment" >> configure.h
[ -n "$undo" ] && echo -e "#undef  UNDO\n#define UNDO $undo" >> configure.h

do_toggle HELP $help
do_toggle SHELL $shell
do_toggle SPELL $spell
do_toggle TAGS $tags
